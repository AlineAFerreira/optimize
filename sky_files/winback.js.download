define(["jquery","liferayTools","authentication","loading","gtmTrack","tools"],function(){acc.liferayTools.parentAddClass("#wrap-winback-sky",".portlet-content","modal-portlet-espace");$("#wrap-winback-sky");var a=$("#modal_winback_chat_reativacao"),e=$("#modal_winback_cobranca"),t=$("#modal_winback_webview"),n=document.querySelector("#wrap-winback-sky").getAttribute("data-gtm-commonfield"),c=acc.tools.getObjParseGtm(document.querySelector("#wrap-winback-sky"),"data-gtm-obj"),i="P_uDSelectAssi",o="SESSION_KEY_USERDATA_ASSI",l="P_uTk",r=function(a){var e=EPSegmentationChatV2+"?signatures="+a.id+"&flow=canceled";function t(a){console.log("Not winback")}sky.ajax("GET",e,null,{authorization:$.cookie(l)},function(e){if(!$("#modal-base-vendida").hasClass("fade in"))if(e.body){var n=JSON.parse(e.body);if(0==n.default&&""!=n.liferayChatId){var c=n.chat;-1!=c.indexOf("directtalk.com.br/")?s(a,c):-1!=c.indexOf("sky.negocie.online")&&-1!=c.indexOf("sinal/")?d(a,c):-1!=c.indexOf("sky.negocie.online")&&-1==c.indexOf("sinal/")&&m(a,c)}else"b"!=a.statusComercialPlanoCliente&&"B"!=a.statusComercialPlanoCliente||s(a,e)}else if(e.chat)if(0==e.default&&""!=e.liferayChatId){var i=e.chat;-1!=i.indexOf("directtalk.com.br/")?s(a,i):-1!=i.indexOf("sky.negocie.online")&&-1!=i.indexOf("sinal/")?d(a,i):-1!=i.indexOf("sky.negocie.online")&&-1==i.indexOf("sinal/")&&m(a,i)}else"b"==a.statusComercialPlanoCliente||"B"==a.statusComercialPlanoCliente?s(a,e):t(e);else t(e)},t,"Site")},s=function(e,t){a.modal(),acc.gtmTrack.pageView(null,null,c.x200,"/navegacao/modal/recuperacao-cliente/"),a.on("click",".btn-chat-winback",function(){a.modal("hide"),u(t)})},d=function(a,t){e.modal(),acc.gtmTrack.pageView(null,null,c.x400,"/navegacao/modal/recuperacao-involuntaria-cliente-chat/"),e.on("click",".btn-chat-winback",function(){e.modal("hide"),u(t)})},m=function(a,e){t.modal(),acc.gtmTrack.pageView(null,null,c.x300,"/navegacao/modal/recuperacao-involuntaria-cliente/"),t.on("click",".btn-chat-winback",function(){t.modal("hide"),u(e)})},u=function(a){window.open(a,"CHAT","width=545,height=570")};setTimeout(function(){!function(){if($(document).on("click",".btn-continue-winback",function(){$(this).closest(".modal").modal("hide")}),acc.authentication.isAuthenticated()){var a=localStorage.getItem(o)?JSON.parse(localStorage.getItem(o)):"";a&&""!=a&&a.forEach(function(a,e){a.id==sessionStorage.getItem(i)&&r(a)})}}()},2e3),document.querySelector("#wrap-winback-sky").addEventListener("click",function(a){for(var e=a.target;e&&e!=this;e=e.parentNode)if(e.matches("[data-gtm]")){var t=e,i=t.getAttribute("data-gtm");if(e.closest("#modal_winback_chat_reativacao")){var o=c[i];if(2==i||3==i)acc.gtmTrack.trackEvent({hash:o,idcms:n});else{var l=acc.tools.normalizeUrl(t.textContent);acc.gtmTrack.trackEvent({hash:o,idcms:n,v_nome_botao:l},null)}}else if(e.closest("#modal_winback_cobranca")){var r=c[i];acc.gtmTrack.trackEvent({hash:r,idcms:n})}else if(e.closest("#modal_winback_webview")){var s=c[i];acc.gtmTrack.trackEvent({hash:s,idcms:n})}break}})});